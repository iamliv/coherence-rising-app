<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coherence Rising — Breath of Faith</title>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    html, body { margin:0; padding:0; background:#FDF6EC; overflow:auto; }
    *{ box-sizing:border-box }

    :root{
      --gold:#F5E6A1; --lav:#C8BFE7; --olive:#A3B18A; --taupe:#D8CFC4; --sky:#A7C7E7;
      --slate:#7D8C8C; --ivory:#FDF6EC; --ink:#2E3131;
      --r:16px; --shadow:0 8px 24px rgba(0,0,0,.08);
    }

    #cr-app{
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      color:var(--ink); max-width:960px; margin:0 auto; padding:1rem 1rem 8px;
    }

    .card{ background:#fff; border-radius:var(--r); box-shadow:var(--shadow); padding:1rem; margin:1rem 0; }
    #cr-app>.card:last-of-type{ margin-bottom:4px; }

    .header{
      border-radius:24px; text-align:center; padding:28px 20px;
      background:linear-gradient(135deg,var(--sky),var(--lav)); color:#1f2937;
    }
    .header h1{ margin:.35rem 0 0; font-weight:700; font-size:clamp(30px,7vw,48px); line-height:1.12; letter-spacing:.2px; }
    .header .byline{ font-size:clamp(14px,2.7vw,16px); font-weight:600; opacity:.8; margin:.2rem 0 .6rem; }
    .header .subtitle{ margin:0; font-size:clamp(18px,3.3vw,22px); line-height:1.5; opacity:.9; }

    #cr-app a{ color:inherit; text-decoration:none; }

    .chip{
      display:inline-block; background:#fff; color:#1f2937;
      border:1px solid rgba(125,140,140,.3); border-radius:999px;
      padding:.35rem .75rem; font-size:.95rem;
    }
    .row{ display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
    .actions{ display:flex; gap:.5rem; flex-wrap:wrap; }
    .header nav{ margin-top:1.4rem; }

    .btn{ border:0; border-radius:12px; padding:.6rem .9rem; background:var(--olive); color:#132b16; font-weight:600; cursor:pointer; box-shadow:0 2px 8px rgba(163,177,138,.35) }
    .btn.secondary{ background:var(--taupe); color:#3b3b3b; }
    .btn.ghost{ background:transparent; border:1px solid rgba(125,140,140,.35); color:#334155; }

    .timer{ font-variant-numeric:tabular-nums; font-size:2rem; font-weight:700; }

    .breath{
      width:100%; aspect-ratio:1.6/1; border-radius:14px; position:relative; overflow:hidden;
      background:
        radial-gradient(100% 130% at 20% 0%, var(--gold), transparent 60%),
        radial-gradient(120% 100% at 100% 100%, var(--lav), transparent 55%),
        radial-gradient(120% 100% at 0% 100%, var(--olive), transparent 55%);
    }
    .orb{
      position:absolute; left:50%; top:50%; width:120px; height:120px; background:rgba(255,255,255,.75);
      border:2px solid rgba(125,140,140,.25); border-radius:50%;
      transform:translate(-50%,-50%) scale(1); transition:transform 3.4s ease-in-out;
      box-shadow:inset 0 0 40px rgba(167,199,231,.6), 0 10px 30px rgba(0,0,0,.12)
    }
    .hint{
      position:absolute; left:50%; bottom:12px; transform:translateX(-50%);
      background:rgba(253,246,236,.85); border:1px solid rgba(125,140,140,.2);
      padding:.25rem .6rem; border-radius:999px; font-size:.9rem
    }

    footer{ text-align:center; color:#475569; padding:8px 12px; margin:0 }
    footer a{ border-bottom:1px dashed rgba(125,140,140,.5) }

    @media (min-width:860px){ .grid{ display:grid; grid-template-columns:1fr 1fr; gap:1rem } }
  </style>
</head>
<body>
  <div id="cr-app" role="application" aria-label="Coherence Rising: Breath of Faith App">
    <header class="header card">
      <h1>Breath of Faith</h1>
      <p class="byline">by Coherence Rising</p>
      <p class="subtitle">A sacred space for prayer, focus, and renewal</p>
      <nav class="row" style="justify-content:center">
        <a class="chip" href="#breathwork">Breathwork</a>
        <a class="chip" href="#pomodoro">Pomodoro</a>
      </nav>
    </header>

    <!-- Breathwork -->
    <section id="breathwork" class="card" aria-labelledby="breathwork-title">
      <h2 id="breathwork-title" style="margin:0 0 .5rem;font-size:1.15rem">Breathwork Break</h2>
      <p style="margin:.25rem 0 .75rem">Guided breathing with gentle cues. Optional music and visuals.</p>

      <div class="row" style="justify-content:space-between;align-items:center">
        <div class="actions" role="group" aria-label="Breath durations">
          <button class="btn" data-mins="3">3 min</button>
          <button class="btn" data-mins="5">5 min</button>
          <button class="btn" data-mins="10">10 min</button>
          <button class="btn" data-mins="15">15 min</button>
          <button class="btn" data-mins="20">20 min</button>
        </div>
        <div class="actions">
          <button id="breathPause" class="btn secondary" disabled>Pause</button>
          <label class="chip"><input type="checkbox" id="toggleViz" checked /> Visuals</label>
        </div>
      </div>

      <div class="grid" style="margin-top:.5rem">
        <div>
          <div class="timer" id="breathTime">00:00</div>
          <p id="breathCue" style="font-weight:600">Ready to begin</p>
          <div class="breath" id="breathViz" aria-hidden="true">
            <div class="orb" id="orb"></div>
            <div class="hint">Follow the orb</div>
          </div>
        </div>
        <div>
          <iframe style="border-radius:12px"
            src="https://open.spotify.com/embed/album/59QgbMZznJd7gAQloXLlk0?utm_source=generator"
            width="100%" height="300" frameborder="0"
            allow="autoplay; encrypted-media; picture-in-picture"
            title="Calming Worship Instrumentals"></iframe>
        </div>
      </div>
    </section>

    <!-- Pomodoro -->
    <section id="pomodoro" class="card" aria-labelledby="pomodoro-title">
      <h2 id="pomodoro-title" style="margin:0 0 .5rem;font-size:1.15rem">Pomodoro Focus</h2>
      <p style="margin:.25rem 0 .75rem">25 minutes on, brief break off — meditate on Scripture while you work.</p>

      <div class="row" style="align-items:center;justify-content:space-between">
        <div class="timer" id="pomo">25:00</div>
        <div class="actions">
          <button id="pomoStart" class="btn">Start</button>
          <button id="pomoPause" class="btn secondary">Pause</button>
          <button id="pomoReset" class="btn ghost">Reset</button>
        </div>
      </div>
      <div id="pomoVerse" class="chip" style="margin:.75rem 0">
        "Commit your work to the LORD, and your plans will be established." — Proverbs 16:3
      </div>

      <iframe style="border-radius:12px"
        src="https://open.spotify.com/embed/album/3lL4wCD0MDpEW2C3wf1DZH?utm_source=generator"
        width="100%" height="300" frameborder="0"
        allow="autoplay; encrypted-media; picture-in-picture"
        title="Focus LoFi"></iframe>

      <div id="toast" style="display:none;margin-top:10px;padding:10px;border:1px solid rgba(125,140,140,.3);border-radius:10px;background:#fff">
        Pomodoro complete! Take a short break. 🌿
      </div>
    </section>
  </div>

  <footer>
    <p><strong>Coherence Rising</strong> · Music & Meditations: <a href="#breathwork">Breathwork</a> · <a href="#pomodoro">Focus</a></p>
    <p style="font-size:.9rem">© <span id="year"></span> Coherence Rising — Prayer & Productivity Companion</p>
  </footer>

  <script>
  // Footer year
  document.getElementById('year').textContent = new Date().getFullYear();

  // Utilities
  const $=(s,r=document)=>r.querySelector(s), $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
  const pad=n=>String(n).padStart(2,'0');
  const fmt=ms=>{ const s=Math.max(0,Math.floor(ms/1000)); return pad(Math.floor(s/60))+':'+pad(s%60); };

  /* =======================
     BREATHWORK (with Pause/Resume)
  ======================= */
  (function(){
    const timeEl=$('#breathTime'), cueEl=$('#breathCue'), orb=$('#orb'), viz=$('#breathViz');
    const toggleViz=$('#toggleViz'), pauseBtn=$('#breathPause');
    const durButtons=$$('#breathwork [data-mins]');

    // Phases: inhale 4s, hold 2s, exhale 6s
    const PHASES=[{name:'inhale',ms:4000},{name:'hold',ms:2000},{name:'exhale',ms:6000}];

    let running=false, paused=false;
    let totalEnd=null, remaining=null; // total time tracking
    let phaseIdx=0, phaseEnd=null, phaseRemaining=null; // phase tracking
    let tickIv=null;

    function setCue(name){
      if(!cueEl||!orb) return;
      if(name==='inhale'){ cueEl.textContent='Inhale — Be still'; orb.style.transform='translate(-50%,-50%) scale(1.25)'; }
      else if(name==='hold'){ cueEl.textContent='Hold — and know'; }
      else if(name==='exhale'){ cueEl.textContent='Exhale — and know'; orb.style.transform='translate(-50%,-50%) scale(0.85)'; }
      else { cueEl.textContent='Ready to begin'; orb.style.transform='translate(-50%,-50%) scale(1)'; }
    }
    function stopTick(){ if(tickIv){ clearInterval(tickIv); tickIv=null; } }
    function update(){
      const now=Date.now();
      const rem=Math.max(0, totalEnd-now);
      if(timeEl) timeEl.textContent=fmt(rem);

      if(rem<=0){
        stopTick(); running=false; paused=false;
        if(pauseBtn){ pauseBtn.disabled=true; pauseBtn.textContent='Pause'; }
        setCue('ready'); if(timeEl) timeEl.textContent='00:00';
        return;
      }
      if(now>=phaseEnd){
        phaseIdx=(phaseIdx+1)%PHASES.length;
        const p=PHASES[phaseIdx];
        phaseEnd=now+p.ms;
        setCue(p.name);
      }
    }
    function start(mins){
      const total = mins*60*1000;
      running=true; paused=false;
      totalEnd = Date.now()+total;
      phaseIdx=0; const p=PHASES[phaseIdx]; phaseEnd=Date.now()+p.ms;
      setCue(p.name);
      if(pauseBtn){ pauseBtn.disabled=false; pauseBtn.textContent='Pause'; }
      stopTick(); tickIv=setInterval(update, 200);
    }
    function pause(){
      if(!running || paused) return;
      const now=Date.now();
      remaining = Math.max(0, totalEnd-now);
      phaseRemaining = Math.max(0, phaseEnd-now);
      paused=true; stopTick();
      if(pauseBtn) pauseBtn.textContent='Resume';
    }
    function resume(){
      if(!running || !paused) return;
      const now=Date.now();
      totalEnd = now + remaining;
      phaseEnd  = now + phaseRemaining;
      paused=false;
      if(pauseBtn) pauseBtn.textContent='Pause';
      stopTick(); tickIv=setInterval(update, 200);
    }

    // Wire UI
    durButtons.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const mins=parseInt(btn.getAttribute('data-mins'),10)||3;
        start(mins);
      });
    });
    if(pauseBtn){
      pauseBtn.addEventListener('click', ()=>{
        if(!running){ return; }
        if(!paused) pause(); else resume();
      });
    }
    if(toggleViz){ toggleViz.addEventListener('change',()=>{ viz.style.display = toggleViz.checked ? 'block' : 'none'; }); }
  })();

  /* =======================
     POMODORO
  ======================= */
  (function(){
    const pomo=$('#pomo'), start=$('#pomoStart'), pause=$('#pomoPause'), reset=$('#pomoReset'), verse=$('#pomoVerse'), toast=$('#toast');
    const verses=[
      '“Be still, and know that I am God.” — Psalm 46:10',
      '“The LORD is my shepherd; I shall not want.” — Psalm 23:1',
      '“Draw near to God, and He will draw near to you.” — James 4:8',
      '“Cast all your anxiety on Him because He cares for you.” — 1 Peter 5:7',
      '“Rejoice in hope, be patient in tribulation, be constant in prayer.” — Romans 12:12',
      '“Your word is a lamp to my feet and a light to my path.” — Psalm 119:105',
      '“Commit your work to the LORD, and your plans will be established.” — Proverbs 16:3',
      '“In all your ways acknowledge Him, and He will make straight your paths.” — Proverbs 3:6',
    ];

    const FULL = 25*60*1000;
    let ends=null, rest=null, iv=null;

    function up(ms){ if(pomo) pomo.textContent=fmt(ms); }
    function startP(){
      if(verse) verse.textContent = verses[Math.floor(Math.random()*verses.length)];
      const now=Date.now(); ends=now + (rest ?? FULL); rest=null;
      if(iv) clearInterval(iv);
      iv=setInterval(()=>{
        const rem=Math.max(0, ends-Date.now()); up(rem);
        if(rem<=0){ clearInterval(iv); iv=null; if(toast){ toast.style.display='block'; setTimeout(()=>toast.style.display='none', 4000);} }
      },250);
    }
    function pauseP(){ if(!iv) return; rest=Math.max(0, ends-Date.now()); clearInterval(iv); iv=null; }
    function resetP(){ if(iv) clearInterval(iv); iv=null; rest=null; up(FULL); }

    if(start) start.addEventListener('click', startP);
    if(pause) pause.addEventListener('click', pauseP);
    if(reset) reset.addEventListener('click', resetP);
    up(FULL);
  })();

  /* =======================
     Robust auto-height for Ontraport embed
  ======================= */
  (function () {
    function pageHeight() {
      var app = document.getElementById('cr-app');
      var foot = document.querySelector('footer');

      function bottom(el){
        if(!el) return 0;
        var r = el.getBoundingClientRect();
        return Math.ceil(r.top + window.scrollY + r.height);
      }

      var h = Math.max(
        bottom(foot),
        bottom(app),
        document.body ? document.body.scrollHeight : 0,
        document.documentElement ? document.documentElement.scrollHeight : 0
      );

      return Math.max(0, h - 1); // nudge -1px to avoid accidental overflow
    }

    function postHeight() {
      try {
        window.parent.postMessage({ type: "CR_HEIGHT", h: pageHeight() }, "*");
      } catch (e) {}
    }

    window.addEventListener("load", postHeight);
    window.addEventListener("resize", postHeight);
    if ("ResizeObserver" in window) {
      new ResizeObserver(postHeight).observe(document.body);
    }
    setTimeout(postHeight, 200);
    setTimeout(postHeight, 600);
    setTimeout(postHeight, 1500);
    setTimeout(postHeight, 3000);
  })();
  </script>
</body>
</html>
