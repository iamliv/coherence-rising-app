<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coherence Rising — Breath of Faith</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --gold:#F5E6A1; --lav:#C8BFE7; --olive:#A3B18A; --taupe:#D8CFC4; --sky:#A7C7E7;
    --slate:#7D8C8C; --ivory:#FDF6EC; --ink:#2E3131; --ink-weak:#4b5563;
    --bg:var(--ivory); --card:#fff; --accent:var(--olive);
    --orb:#ffffffc0; --cue:#1f2937; --viz-line:#24423a;
    --r:16px; --shadow:0 8px 24px rgba(0,0,0,.08);
  }
  @media (prefers-color-scheme: dark){
    :root{ --bg:#0e1012; --card:#13161a; --ink:#e6e9ee; --ink-weak:#aab2bf; --accent:#7aa57a; --orb:#ffffff26; --cue:#e6e9ee; --viz-line:#7aa57a; }
  }
  body[data-theme="night"]{
    --bg:#0b0e11; --card:#101317; --ink:#e5ecf3; --ink-weak:#a6b0bf;
    --accent:#7aa57a; --orb:#ffffff22; --cue:#eef3f8; --viz-line:#6fa46f;
  }

  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink)}
  *{box-sizing:border-box}
  #cr-app{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;-webkit-font-smoothing:antialiased;max-width:980px;margin:0 auto;padding:1rem 1rem 10px}
  .card{background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);padding:1rem;margin:1rem 0}
  .header{border-radius:24px;text-align:center;padding:28px 20px;background:linear-gradient(135deg,var(--sky),var(--lav));color:#102232}
  .header h1{margin:.3rem 0 0;font-weight:700;font-size:clamp(30px,7vw,48px);line-height:1.12}
  .header .byline{font-size:clamp(14px,2.7vw,16px);font-weight:600;opacity:.9;margin:.2rem 0 .6rem}
  .header .subtitle{margin:0;font-size:clamp(18px,3.3vw,22px);line-height:1.5;opacity:.9}
  nav a{display:inline-block;background:#ffffffd9;color:#1f2937;border:1px solid #0001;border-radius:999px;padding:.35rem .75rem;text-decoration:none}
  .row{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
  .actions{display:flex;gap:.5rem;flex-wrap:wrap}
  .btn{border:0;border-radius:12px;padding:.6rem .9rem;background:var(--accent);color:#132b16;font-weight:600;cursor:pointer;box-shadow:0 2px 8px rgba(163,177,138,.35)}
  .btn.secondary{background:var(--taupe);color:#2b2b2b}
  .btn.ghost{background:transparent;border:1px solid #0003;color:var(--ink)}
  .select{border:1px solid #0003;background:var(--card);color:var(--ink);border-radius:10px;padding:.5rem .6rem}
  .timer{font-variant-numeric:tabular-nums;font-size:2rem;font-weight:700}

  /* Breathwork visual container */
  .viz-wrap{
    position:relative;width:100%;
    height:min(72vh, 95vw); /* tall on phones, avoid wider-than-screen */
    border-radius:14px;overflow:hidden;
    background:radial-gradient(100% 130% at 20% 0%, var(--gold), transparent 60%),
               radial-gradient(120% 100% at 100% 100%, var(--lav), transparent 55%),
               radial-gradient(120% 100% at 0% 100%, var(--olive), transparent 55%);
  }
  body[data-theme="night"] .viz-wrap{background:linear-gradient(180deg,#0c1210,#0a0f0d)}

  /* Unified scale group for ALL visuals */
  .viz-scale{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(1);
    transform-origin:center center;will-change:transform;
    transition:transform 3.6s ease-in-out;
  }

  /* Orb (transparent; no background box) */
  .orb{width:min(68vmin, 92vw);height:min(68vmin, 92vw);background:var(--orb);
       border:2px solid #0003;border-radius:50%;
       box-shadow:inset 0 0 100px rgba(167,199,231,.25), 0 10px 30px rgba(0,0,0,.12)}

  /* SVG/canvas boxes (transparent) */
  .svg-box{width:min(74vmin, 96vw);height:min(74vmin, 96vw)}
  .svg-fit{width:100%;height:100%}

  /* Protestant cross (SVG stroked path, no background) */
  .cross-shape{fill:none;stroke:var(--viz-line);stroke-width:40;stroke-linecap:round;stroke-linejoin:round;filter:drop-shadow(0 6px 16px rgba(0,0,0,.25))}
  .cross-glow{stroke:rgba(255,255,255,.08);stroke-width:80}

  /* Branches (transparent) */
  .branches line{stroke:var(--viz-line);stroke-width:1.6;stroke-linecap:round}

  /* Starfield */
  #starCanvas{display:block;width:100%;height:100%}

  /* Centered cue for ALL visuals */
  .cue-center{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    text-align:center;font-weight:700;letter-spacing:.2px;color:var(--cue);
    font-size:clamp(20px,5vw,28px);padding:.25rem .5rem;border-radius:8px;background:transparent;
    text-shadow:0 1px 2px rgba(0,0,0,.25);pointer-events:none;
  }
  .hint{position:absolute;left:50%;bottom:10px;transform:translateX(-50%);background:#0002;color:#fff;
        padding:.25rem .6rem;border-radius:999px;font-size:.85rem}

  footer{text-align:center;color:var(--ink-weak);padding:10px 12px}
  @media (min-width:860px){ .grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem} }
</style>
</head>
<body>
<div id="cr-app" role="application" aria-label="Coherence Rising: Breath of Faith App">
  <header class="header card">
    <h1>Breath of Faith</h1>
    <p class="byline">by Coherence Rising</p>
    <p class="subtitle">A sacred space for prayer, focus, and renewal</p>
    <nav class="row" style="justify-content:center">
      <a href="#breathwork">Breathwork</a>
      <a href="#pomodoro">Pomodoro</a>
      <button id="nightToggle" class="btn ghost" style="margin-left:.5rem">Night mode</button>
    </nav>
  </header>

  <!-- Breathwork -->
  <section id="breathwork" class="card" aria-labelledby="breathwork-title">
    <h2 id="breathwork-title" style="margin:0 0 .5rem;font-size:1.15rem">Breathwork Break</h2>
    <p style="margin:.25rem 0 .75rem">Pick a visual and a breathing pattern. Go fullscreen if you like. Follow the centered cue.</p>

    <div class="row" style="justify-content:space-between;align-items:center">
      <div class="actions" role="group" aria-label="Breath durations">
        <button class="btn" data-mins="3">3 min</button>
        <button class="btn" data-mins="5">5 min</button>
        <button class="btn" data-mins="10">10 min</button>
        <button class="btn" data-mins="15">15 min</button>
        <button class="btn" data-mins="20">20 min</button>
        <button id="breathPause" class="btn secondary" disabled>Pause</button>
      </div>
      <div class="row">
        <select id="patternSelect" class="select" aria-label="Breathing pattern">
          <option value="box-3">Box: 3-3-3-3</option>
          <option value="box-4">Box: 4-4-4-4</option>
          <option value="box-6">Box: 6-6-6-6</option>
          <option value="even-4">Even: 4-4</option>
          <option value="even-6">Even: 6-6</option>
          <option value="even-8">Even: 8-8</option>
        </select>
        <select id="vizSelect" class="select" aria-label="Visual" style="margin-left:.5rem">
          <option value="orb">Orb</option>
          <option value="cross">Cross</option>
          <option value="branches">Branches</option>
          <option value="star">Starfield</option>
        </select>
        <button id="fsToggle" class="btn ghost" aria-label="Toggle Fullscreen" style="margin-left:.5rem">Fullscreen</button>
      </div>
    </div>

    <div class="grid" style="margin-top:.75rem">
      <div>
        <div class="timer" id="breathTime">00:00</div>

        <div id="vizWrap" class="viz-wrap" tabindex="0" aria-live="polite">
          <!-- Unified scale group -->
          <div id="vizScale" class="viz-scale">
            <!-- Orb -->
            <div id="orbBox" class="orb" aria-hidden="false"></div>

            <!-- Cross (Protestant: long vertical, shorter horizontal; transparent) -->
            <div id="crossBox" class="svg-box" aria-hidden="true" style="display:none">
              <svg id="crossSVG" class="svg-fit" viewBox="0 0 1000 1000" role="img" aria-label="Protestant Christian cross">
                <!-- Transparent background; only strokes render -->
                <g>
                  <!-- soft glow under-stroke -->
                  <path class="cross-glow" d="M500 140 L500 860 M250 430 L750 430"/>
                  <!-- main cross -->
                  <path class="cross-shape" d="M500 160 L500 840 M280 430 L720 430"/>
                </g>
              </svg>
            </div>

            <!-- Branches -->
            <div id="branchBox" class="svg-box" aria-hidden="true" style="display:none">
              <svg id="branchSVG" class="svg-fit" viewBox="0 0 1000 1000" role="img" aria-label="Fractal branches">
                <!-- transparent background -->
                <g id="branchGroup" class="branches"></g>
              </svg>
            </div>

            <!-- Starfield -->
            <div id="starBox" class="svg-box" aria-hidden="true" style="display:none">
              <canvas id="starCanvas" width="1000" height="1000" aria-label="Gentle starfield"></canvas>
            </div>
          </div>

          <!-- Cue (centered for ALL modes) -->
          <div id="cue" class="cue-center">Ready to begin</div>
          <div class="hint fade">Press a duration to start</div>
        </div>
      </div>

      <div>
        <iframe style="border-radius:12px"
          src="https://open.spotify.com/embed/album/59QgbMZznJd7gAQloXLlk0?utm_source=generator"
          width="100%" height="300" frameborder="0"
          allow="autoplay; encrypted-media; picture-in-picture"
          title="Calming Worship Instrumentals"></iframe>
      </div>
    </div>
  </section>

  <!-- Pomodoro -->
  <section id="pomodoro" class="card" aria-labelledby="pomodoro-title">
    <h2 id="pomodoro-title" style="margin:0 0 .5rem;font-size:1.15rem">Pomodoro Focus</h2>
    <p style="margin:.25rem 0 .75rem">25 minutes on, brief break off — meditate on Scripture while you work.</p>

    <div class="row" style="align-items:center;justify-content:space-between">
      <div class="timer" id="pomo">25:00</div>
      <div class="actions">
        <button id="pomoStart" class="btn">Start</button>
        <button id="pomoPause" class="btn secondary">Pause</button>
        <button id="pomoReset" class="btn ghost">Reset</button>
      </div>
    </div>
    <div id="pomoVerse" class="row" style="gap:.4rem;margin:.75rem 0;color:var(--ink-weak)">
      “Commit your work to the LORD, and your plans will be established.” — Proverbs 16:3
    </div>

    <iframe style="border-radius:12px"
      src="https://open.spotify.com/embed/album/3lL4wCD0MDpEW2C3wf1DZH?utm_source=generator"
      width="100%" height="300" frameborder="0"
      allow="autoplay; encrypted-media; picture-in-picture"
      title="Focus LoFi"></iframe>

    <div id="toast" style="display:none;margin-top:10px;padding:10px;border:1px solid #0003;border-radius:10px;background:var(--card)">
      Pomodoro complete! Take a short break. 🌿
    </div>
  </section>
</div>

<footer>
  <p><strong>Coherence Rising</strong> · Music & Meditations</p>
  <p style="font-size:.9rem">© <span id="year"></span> Coherence Rising — Prayer & Productivity Companion</p>
</footer>

<script>
  // Year
  document.getElementById('year').textContent = new Date().getFullYear();

  // Night mode
  (function(){
    var nightBtn = document.getElementById('nightToggle');
    if (!nightBtn) return;
    nightBtn.addEventListener('click', function(){
      var isNight = document.body.getAttribute('data-theme') === 'night';
      if (isNight) { document.body.removeAttribute('data-theme'); nightBtn.textContent = 'Night mode'; }
      else { document.body.setAttribute('data-theme','night'); nightBtn.textContent = 'Day mode'; }
    });
  })();

  // Utilities
  var $=function(s,r){return (r||document).querySelector(s)}, $$=function(s,r){return Array.prototype.slice.call((r||document).querySelectorAll(s));};
  var pad=function(n){return String(n).padStart(2,'0')};
  var fmt=function(ms){var s=Math.max(0,Math.floor(ms/1000));return pad(Math.floor(s/60))+':'+pad(s%60)};

  /* =======================
     BREATHWORK (visuals + patterns)
  ======================= */
  (function(){
    var timeEl=$('#breathTime'), cueEl=$('#cue');
    var vizWrap=$('#vizWrap'), vizScale=$('#vizScale');
    var vizSelect=$('#vizSelect'), patternSelect=$('#patternSelect');
    var pauseBtn=$('#breathPause'); var durButtons=$$('#breathwork [data-mins]');

    var orbBox=$('#orbBox'), crossBox=$('#crossBox'), branchBox=$('#branchBox'), starBox=$('#starBox');
    var branchGroup=$('#branchGroup');
    var starCanvas=$('#starCanvas'), starCtx = starCanvas && starCanvas.getContext ? starCanvas.getContext('2d') : null;

    // PATTERNS
    var PATTERNS={
      'box-3':  [{name:'inhale',ms:3000,scale:1.85},{name:'hold',ms:3000,scale:null},{name:'exhale',ms:3000,scale:0.9},{name:'hold',ms:3000,scale:null}],
      'box-4':  [{name:'inhale',ms:4000,scale:1.85},{name:'hold',ms:4000,scale:null},{name:'exhale',ms:4000,scale:0.9},{name:'hold',ms:4000,scale:null}],
      'box-6':  [{name:'inhale',ms:6000,scale:1.85},{name:'hold',ms:6000,scale:null},{name:'exhale',ms:6000,scale:0.9},{name:'hold',ms:6000,scale:null}],
      'even-4': [{name:'inhale',ms:4000,scale:1.85},{name:'exhale',ms:4000,scale:0.9}],
      'even-6': [{name:'inhale',ms:6000,scale:1.85},{name:'exhale',ms:6000,scale:0.9}],
      'even-8': [{name:'inhale',ms:8000,scale:1.85},{name:'exhale',ms:8000,scale:0.9}],
    };
    var REST_SCALE = 1.05;
    var phases = PATTERNS['box-4']; // default

    var running=false, paused=false;
    var totalEnd=null, remaining=null;
    var phaseIdx=0, phaseEnd=null, phaseRemaining=null;
    var tickIv=null;

    // Visual switcher (all transparent; only shapes drawn)
    function show(mode){
      orbBox.style.display    = (mode==='orb') ? 'block' : 'none';
      crossBox.style.display  = (mode==='cross') ? 'block' : 'none';
      branchBox.style.display = (mode==='branches') ? 'block' : 'none';
      starBox.style.display   = (mode==='star') ? 'block' : 'none';
      if(mode==='star') startStars(); else stopStars();
    }
    vizSelect.addEventListener('change',function(){ show(vizSelect.value); });
    show('orb');

    // Branches (generated once; transparent background)
    function drawBranches(){
      branchGroup.innerHTML='';
      var W=1000,H=1000;
      function seg(x1,y1,len,ang,depth){
        if(depth<=0||len<6) return;
        var x2=x1+Math.cos(ang)*len, y2=y1+Math.sin(ang)*len;
        var ln=document.createElementNS('http://www.w3.org/2000/svg','line');
        ln.setAttribute('x1',x1); ln.setAttribute('y1',y1);
        ln.setAttribute('x2',x2); ln.setAttribute('y2',y2);
        ln.setAttribute('opacity', String(0.25+0.75*(depth/9)));
        branchGroup.appendChild(ln);
        var nlen=len*(0.68+Math.random()*0.08);
        seg(x2,y2,nlen,ang-0.6+Math.random()*0.15,depth-1);
        seg(x2,y2,nlen,ang+0.55-Math.random()*0.15,depth-1);
      }
      seg(W*0.5,H*0.98,190,-Math.PI/2,10);
      seg(W*0.2,H*0.95,135,-Math.PI/2.2,9);
      seg(W*0.8,H*0.96,140,-Math.PI/1.8,9);
    }
    drawBranches();

    // Starfield (gentle drift; speed subtly tied to scale for "breathing" feel)
    var stars=[], animId=null, lastT=0, starDrift=0.03;
    function initStars(){
      if(!starCanvas || !starCtx) return;
      var count = 180;
      var W = starCanvas.width, H = starCanvas.height;
      stars = new Array(count);
      for(var i=0;i<count;i++){
        stars[i] = {
          x: Math.random()*W, y: Math.random()*H,
          r: 0.7 + Math.random()*1.8,
          a: Math.random()*Math.PI*2,
          tw: 0.001 + Math.random()*0.002,
          z: 0.5 + Math.random()*1.5 // depth-ish factor
        };
      }
    }
    function renderStars(dt){
      if(!starCanvas || !starCtx) return;
      var W = starCanvas.width, H = starCanvas.height;
      starCtx.clearRect(0,0,W,H);
      // transparent canvas; draw only stars (no boxy background)
      for(var i=0;i<stars.length;i++){
        var s=stars[i];
        s.a += s.tw * dt;
        // drift slightly downward; stronger when "inhale" (scale larger)
        s.y += starDrift * s.z * dt * 0.02;
        if(s.y > H+5) s.y = -5;

        var glow = 0.6 + 0.4*Math.sin(s.a);
        starCtx.globalAlpha = 0.25 + 0.75*glow;
        starCtx.beginPath();
        starCtx.arc(s.x,s.y,s.r,0,Math.PI*2);
        starCtx.fillStyle = '#c9d6ff';
        starCtx.fill();
      }
      starCtx.globalAlpha = 1;
    }
    function tickStars(ts){
      if(!lastT) lastT = ts;
      var dt = ts - lastT; lastT = ts;
      renderStars(dt);
      animId = window.requestAnimationFrame(tickStars);
    }
    function startStars(){ if(animId) return; initStars(); lastT=0; animId=window.requestAnimationFrame(tickStars); }
    function stopStars(){ if(animId) window.cancelAnimationFrame(animId); animId=null; }

    // Cue + scale
    function setCue(name){
      if(!cueEl) return;
      if(name==='inhale') cueEl.textContent='Inhale — Be still';
      else if(name==='hold') cueEl.textContent='Hold — and know';
      else if(name==='exhale') cueEl.textContent='Exhale — and know';
      else cueEl.textContent='Ready to begin';
    }
    function setScaleForPhase(phase){
      vizScale.style.transitionDuration = (phase.ms/1000)+'s';
      if(phase.scale!=null){
        var s = phase.scale;
        vizScale.style.transform = 'translate(-50%,-50%) scale('+s+')';
        // tie star drift subtly to scale (bigger -> slightly faster)
        starDrift = (s-0.9) * 0.06 + 0.02; // gentle range ~0.02–0.08
      }
    }
    function resetScale(){
      vizScale.style.transitionDuration = '0.4s';
      vizScale.style.transform = 'translate(-50%,-50%) scale('+REST_SCALE+')';
      starDrift = 0.03;
    }
    resetScale();

    function stopTick(){ if(tickIv){ clearInterval(tickIv); tickIv=null; } }

    function update(){
      var now=Date.now();
      var rem=Math.max(0, totalEnd-now);
      if(timeEl) timeEl.textContent=fmt(rem);

      if(rem<=0){
        stopTick(); running=false; paused=false;
        if(pauseBtn){ pauseBtn.disabled=true; pauseBtn.textContent='Pause'; }
        setCue('ready'); if(timeEl) timeEl.textContent='00:00';
        resetScale();
        return;
      }
      if(now>=phaseEnd){
        phaseIdx=(phaseIdx+1)%phases.length;
        var p=phases[phaseIdx];
        phaseEnd=now+p.ms;
        setCue(p.name);
        setScaleForPhase(p);
      }
    }
    function start(mins){
      var total = mins*60*1000;
      running=true; paused=false;
      totalEnd = Date.now()+total;
      phaseIdx=0; var p=phases[phaseIdx]; phaseEnd=Date.now()+p.ms;
      setCue(p.name);
      setScaleForPhase(p);
      if(pauseBtn){ pauseBtn.disabled=false; pauseBtn.textContent='Pause'; }
      stopTick(); tickIv=setInterval(update, 200);
      update(); // show immediately
    }
    function pause(){
      if(!running || paused) return;
      var now=Date.now();
      remaining = Math.max(0, totalEnd-now);
      phaseRemaining = Math.max(0, phaseEnd-now);
      paused=true; stopTick();
      if(pauseBtn) pauseBtn.textContent='Resume';
    }
    function resume(){
      if(!running || !paused) return;
      var now=Date.now();
      totalEnd = now + remaining;
      phaseEnd  = now + phaseRemaining;
      paused=false;
      if(pauseBtn) pauseBtn.textContent='Pause';
      stopTick(); tickIv=setInterval(update, 200);
      update();
    }

    // Pattern selection
    patternSelect.addEventListener('change', function(){
      phases = PATTERNS[patternSelect.value] || PATTERNS['box-4'];
      // If mid-session, restart from the new pattern timing (polite behavior)
      if(running){ pause(); resume(); }
    });

    // Fullscreen (with WebKit/MS fallbacks)
    var fsBtn=$('#fsToggle');
    function enterFS(el){
      try{
        if(el.requestFullscreen) el.requestFullscreen();
        else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        else if(el.msRequestFullscreen) el.msRequestFullscreen();
      }catch(e){}
    }
    function exitFS(){
      try{
        if(document.exitFullscreen) document.exitFullscreen();
        else if(document.webkitExitFullscreen) document.webkitExitFullscreen();
        else if(document.msExitFullscreen) document.msExitFullscreen();
      }catch(e){}
    }
    function toggleFS(){
      if(!document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement){
        enterFS(vizWrap);
      }else{
        exitFS();
      }
    }
    if(fsBtn) fsBtn.addEventListener('click', toggleFS);

    // Wire durations + pause
    durButtons.forEach(function(btn){
      btn.addEventListener('click', function(){
        var mins=parseInt(btn.getAttribute('data-mins'),10)||3;
        start(mins);
      });
    });
    if(pauseBtn) pauseBtn.addEventListener('click', function(){ if(!running) return; paused?resume():pause(); });
  })();

  /* =======================
     POMODORO
  ======================= */
  (function(){
    var pomo=$('#pomo'), start=$('#pomoStart'), pause=$('#pomoPause'), reset=$('#pomoReset'), verse=$('#pomoVerse'), toast=$('#toast');
    var verses=[
      '“Be still, and know that I am God.” — Psalm 46:10',
      '“The LORD is my shepherd; I shall not want.” — Psalm 23:1',
      '“Draw near to God, and He will draw near to you.” — James 4:8',
      '“Cast all your anxiety on Him because He cares for you.” — 1 Peter 5:7',
      '“Rejoice in hope, be patient in tribulation, be constant in prayer.” — Romans 12:12',
      '“Your word is a lamp to my feet and a light to my path.” — Psalm 119:105',
      '“Commit your work to the LORD, and your plans will be established.” — Proverbs 16:3',
      '“In all your ways acknowledge Him, and He will make straight your paths.” — Proverbs 3:6',
    ];

    var FULL = 25*60*1000;
    var ends=null, rest=null, iv=null;

    function up(ms){ if(pomo) pomo.textContent=fmt(ms); }
    function startP(){
      if(verse) verse.textContent = verses[Math.floor(Math.random()*verses.length)];
      var now=Date.now(); ends=now + (rest ?? FULL); rest=null;
      if(iv) clearInterval(iv);
      iv=setInterval(function(){
        var rem=Math.max(0, ends-Date.now()); up(rem);
        if(rem<=0){ clearInterval(iv); iv=null; if(toast){ toast.style.display='block'; setTimeout(function(){toast.style.display='none'}, 4000);} }
      },250);
    }
    function pauseP(){ if(!iv) return; rest=Math.max(0, ends-Date.now()); clearInterval(iv); iv=null; }
    function resetP(){ if(iv) clearInterval(iv); iv=null; rest=null; up(FULL); }

    if(start) start.addEventListener('click', startP);
    if(pause) pause.addEventListener('click', pauseP);
    if(reset) reset.addEventListener('click', resetP);
    up(FULL);
  })();

  /* =======================
     Auto-height message (harmless if standalone)
  ======================= */
  (function () {
    function elementBottom(el){ if(!el) return 0; var r=el.getBoundingClientRect(); return Math.ceil((window.scrollY||0)+r.bottom); }
    function pageHeight() {
      var app = document.getElementById('cr-app'); var foot = document.querySelector('footer');
      var b=document.body, d=document.documentElement;
      var h=Math.max(elementBottom(foot),elementBottom(app),b?b.scrollHeight:0,d?d.scrollHeight:0,b?b.offsetHeight:0,d?d.offsetHeight:0);
      return Math.max(0, Math.floor(h-2));
    }
    function postHeight(){ try{ window.parent.postMessage({type:"CR_HEIGHT",h:pageHeight()},"*"); }catch(e){} }
    window.addEventListener("load", postHeight);
    window.addEventListener("resize", postHeight);
    if (document.fonts && document.fonts.ready) document.fonts.ready.then(postHeight);
    Array.prototype.forEach.call(document.querySelectorAll("iframe"), function(i){ i.addEventListener("load", function(){ setTimeout(postHeight,50); setTimeout(postHeight,400); }); });
    setTimeout(postHeight,150); setTimeout(postHeight,600); setTimeout(postHeight,1500); setTimeout(postHeight,3000);
  })();
</script>
</body>
</html>
